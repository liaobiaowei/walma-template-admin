<template>
  <v-chart
    ref="vChartRef"
    :theme="themeColor"
    :option="option"
    :manual-update="isPreview()"
    autoresize
  />
</template>

<script setup lang="ts">
  import { computed, PropType } from 'vue';
  import VChart from 'vue-echarts';
  import { use } from 'echarts/core';
  import { CanvasRenderer } from 'echarts/renderers';
  import { BarChart } from 'echarts/charts';
  import { mergeTheme } from '/@/packages/public/chart';
  import config, { includes } from './config';
  import { useChartDataFetch } from '/@/hooks/largeScreen';
  import { useChartEditStore } from '/@/store/modules/largeScreen/chartEditStore/chartEditStore';
  import { isPreview } from '/@/utils/largeScreen';
  import {
    DatasetComponent,
    GridComponent,
    TooltipComponent,
    LegendComponent,
  } from 'echarts/components';

  const props = defineProps({
    themeSetting: {
      type: Object,
      required: true,
    },
    themeColor: {
      type: Object,
      required: true,
    },
    chartConfig: {
      type: Object as PropType<config>,
      required: true,
    },
  });

  use([
    DatasetComponent,
    CanvasRenderer,
    BarChart,
    GridComponent,
    TooltipComponent,
    LegendComponent,
  ]);

  const option = computed(() => {
    return mergeTheme(props.chartConfig.option, props.themeSetting, includes);
  });

  const { vChartRef } = useChartDataFetch(props.chartConfig, useChartEditStore);
</script>
